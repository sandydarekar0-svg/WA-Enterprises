<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container-fluid">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">WhatsApp Bulk Sender</a>
            <a href="/logout" class="btn btn-danger btn-sm">Logout</a>
        </div>
    </nav>

    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5>Total Users</h5>
                    <h2 id="totalUsers">--</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5>Total Messages</h5>
                    <h2 id="totalMessages">--</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5>Total Campaigns</h5>
                    <h2 id="totalCampaigns">--</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5>Total Revenue</h5>
                    <h2 id="totalRevenue">--</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5>All Users</h5>
                </div>
                <div class="card-body">
                    <table class="table table-striped" id="usersTable">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Credits</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersList"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Load admin stats
fetch('/api/admin.php?action=stats')
    .then(r => r.json())
    .then(d => {
        document.getElementById('totalUsers').textContent = d.data.total_users;
        document.getElementById('totalMessages').textContent = d.data.total_messages;
        document.getElementById('totalCampaigns').textContent = d.data.total_campaigns;
        document.getElementById('totalRevenue').textContent = '$' + d.data.total_revenue;
    });

// Load users
fetch('/api/admin.php?action=users')
    .then(r => r.json())
    .then(d => {
        const html = d.data.map(u => `
            <tr>
                <td>${u.username}</td>
                <td>${u.email}</td>
                <td><span class="badge bg-primary">${u.role}</span></td>
                <td>${u.credits}</td>
                <td>
                    <button class="btn btn-sm btn-success" onclick="addCredits(${u.id})">Add Credits</button>
                </td>
            </tr>
        `).join('');
        document.getElementById('usersList').innerHTML = html;
    });

function addCredits(userId) {
    const credits = prompt('Add how many credits?');
    if (credits) {
        fetch('/api/admin.php?action=add_credits', {
            method: 'POST',
            body: new FormData(Object.assign(document.createElement('form'), {
                innerHTML: `<input name="user_id" value="${userId}"><input name="credits" value="${credits}">`
            }))
        }).then(r => r.json()).then(d => {
            alert(d.message);
            location.reload();
        });
    }
}
</script>
</body>
  </html>
